<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Document</title>
</head>

<body>
    <style>
        .spanWrapper {
            display: inline-block;
            width: 80%;
            border-bottom: 1px solid red;
        }
    </style>
    <div id="testDiv">
        <div class="spanWrapper">
            <span class="text">I am span</span>
        </div>
        <ul>
            <li><button><span>1</span></button></li>
            <li><button><span>2</span></button></li>
            <li><button><span>3</span></button></li>
            <li><button><span>4</span></button></li>
            <li><button><span>5</span></button></li>
            <li><button><span>6</span></button></li>
            <li><button><span>7</span></button></li>
            <li><button><span>8</span></button></li>
            <li><button><span>9</span></button></li>
            <li><button><span>10</span></button></li>
            <li><button><span>11</span></button></li>
            <li><button><span>12</span></button></li>
            <li><button><span>13</span></button></li>
            <li><button><span>14</span></button></li>
            <li><button><span>15</span></button></li>
            <li><button><span>16</span></button></li>
            <li><button><span>17</span></button></li>
            <li><button><span>18</span></button></li>
            <li><button><span>19</span></button></li>
            <li><button><span>20</span></button></li>
            <li><button><span>21</span></button></li>
            <li><button><span>22</span></button></li>
            <li><button><span>23</span></button></li>
            <li><button><span>24</span></button></li>
            <li><button><span>25</span></button></li>
            <li><button><span>26</span></button></li>
            <li><button><span>27</span></button></li>
            <li><button><span>28</span></button></li>
            <li><button><span>29</span></button></li>
            <li><button><span>30</span></button></li>
            <li><button><span>31</span></button></li>
            <li><button><span>32</span></button></li>
            <li><button><span>33</span></button></li>
            <li><button><span>34</span></button></li>
            <li><button><span>35</span></button></li>
            <li><button><span>36</span></button></li>
            <li><button><span>37</span></button></li>
            <li><button><span>38</span></button></li>
            <li><button><span>39</span></button></li>
            <li><button><span>40</span></button></li>
            <li><button><span>41</span></button></li>
            <li><button><span>42</span></button></li>
            <li><button><span>43</span></button></li>
            <li><button><span>44</span></button></li>
            <li><button><span>45</span></button></li>
            <li><button><span>46</span></button></li>
            <li><button><span>47</span></button></li>
            <li><button><span>48</span></button></li>
            <li><button><span>49</span></button></li>
            <li><button><span>50</span></button></li>
            <li><button><span>51</span></button></li>
            <li><button><span>52</span></button></li>
            <li><button><span>53</span></button></li>
            <li><button><span>54</span></button></li>
            <li><button><span>55</span></button></li>
            <li><button><span>56</span></button></li>
            <li><button><span>57</span></button></li>
            <li><button><span>58</span></button></li>
            <li><button><span>59</span></button></li>
            <li><button><span>60</span></button></li>
            <li><button><span>61</span></button></li>
            <li><button><span>62</span></button></li>
            <li><button><span>63</span></button></li>
            <li><button><span>64</span></button></li>
            <li><button><span>65</span></button></li>
            <li><button><span>66</span></button></li>
            <li><button><span>67</span></button></li>
            <li><button><span>68</span></button></li>
            <li><button><span>69</span></button></li>
            <li><button><span>70</span></button></li>
            <li><button><span>71</span></button></li>
            <li><button><span>72</span></button></li>
            <li><button><span>73</span></button></li>
            <li><button><span>74</span></button></li>
            <li><button><span>75</span></button></li>
            <li><button><span>76</span></button></li>
            <li><button><span>77</span></button></li>
            <li><button><span>78</span></button></li>
            <li><button><span>79</span></button></li>
            <li><button><span>80</span></button></li>
            <li><button><span>81</span></button></li>
            <li><button><span>82</span></button></li>
            <li><button><span>83</span></button></li>
            <li><button><span>84</span></button></li>
            <li><button><span>85</span></button></li>
            <li><button><span>86</span></button></li>
            <li><button><span>87</span></button></li>
            <li><button><span>88</span></button></li>
            <li><button><span>89</span></button></li>
            <li><button><span>90</span></button></li>
            <li><button><span>91</span></button></li>
            <li><button><span>92</span></button></li>
            <li><button><span>93</span></button></li>
            <li><button><span>94</span></button></li>
            <li><button><span>95</span></button></li>
            <li><button><span>96</span></button></li>
            <li><button><span>97</span></button></li>
            <li><button><span>98</span></button></li>
            <li><button><span>99</span></button></li>
            <li><button><span>100</span></button></li>
        </ul>
    </div>
    <script type="text/javascript">
        function on(eventName, delegateSelector, selector, fn) {
            let eleDelegator = null
            if (delegateSelector instanceof Element) {
                eleDelegator = delegateSelector
            } else {
                eleDelegator = document.querySelector(delegateSelector) // 受委托元素或被委托元素 delegate
            }

            eleDelegator.addEventListener(eventName, (e) => {
                let ele = e.target // 委托元素（委托自己的事件给祖先元素） delegated
                while (!ele.matches(selector)) {
                    if (ele === eleDelegator) {
                        ele = null // 没有找到「委托元素」
                        break;
                    }
                    ele = ele.parentNode
                }
                // 回调函数的 this 指向委托元素 li
                ele && fn.call(ele, e)
            })
            return eleDelegator
        }
        // 测试一：
        // on('click', '#testDiv', 'li', function (e) {
        //     console.log(this.innerHTML);
        // })

        // 测试二：
        let divTest = document.querySelector('#testDiv')
        on('click', divTest, 'li', function (e) {
            console.log(this.innerHTML);
        })
    </script>
</body>

</html>